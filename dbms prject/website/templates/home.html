{% extends "base.html" %}
{% block title %}Home{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="bg-gradient-to-r from-blue-50 to-white rounded-2xl shadow-lg overflow-hidden mb-8 border border-gray-200">
  <div class="flex flex-col md:flex-row items-center">
    <div class="md:w-1/2 p-8 md:p-12 lg:p-16">
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-gray-800 mb-4">
        Welcome, {{ user.first_name }}!
      </h1>
      <p class="text-xl text-gray-600 mb-8 max-w-2xl">
        Your BloodBank Dashboard - Connecting donors with those in need. Together, we can save lives.
      </p>
      <div class="flex flex-wrap gap-4">
        {% if not is_donor %}
        <a href="{{ url_for('auth.register_donor') }}" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-bold transition duration-300 shadow-md">
          Become a Donor
        </a>
        {% endif %}
        <a href="/make_request" class="bg-white border-2 border-red-600 text-red-600 hover:bg-red-50 px-6 py-3 rounded-lg font-bold transition duration-300 shadow-sm">
          Make a Request
        </a>
      </div>
    </div>
    <div class="md:w-1/2 p-4 flex justify-center">
    
        <img src="{{ url_for('static', filename='Blood-Donation-1.jpg') }}" alt="Blood Donation Illustration" class="w-full h-auto max-w-md">
    </div>
  </div>
</div>

<!-- Action Cards Section -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
  <!-- Card 1: Donor Status -->
  <div class="bg-white rounded-xl shadow-md overflow-hidden border-l-4 border-blue-500">
    <div class="p-6">
      <div class="flex items-center mb-4">
        <div class="bg-blue-100 p-3 rounded-lg mr-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
        </div>
        <h3 class="text-xl font-bold text-gray-800">Donor Status</h3>
      </div>
      {% if is_donor %}
      <p class="text-green-600 font-semibold mb-3">
        You are currently registered as an active blood donor. Thank you for your commitment!
      </p>
      <p class="text-gray-600 text-sm mb-4">Your profile can be seen by users viewing the donor list.</p>
      <form method="POST" action="{{ url_for('auth.remove_donor') }}" onsubmit="return confirm('Are you sure you want to remove yourself from the donor list? This cannot be undone.');">
        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition duration-300 text-sm">
          Remove Me from Donor List
        </button>
      </form>
      {% else %}
      <p class="text-gray-700 mb-4">
        You are not currently registered as a donor. Consider registering to help save lives!
      </p>
      <a href="{{ url_for('auth.register_donor') }}" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition duration-300 text-sm inline-block">
        Register as Donor
      </a>
      {% endif %}
    </div>
  </div>

  <!-- Card 2: Make a Request -->
  <div class="bg-white rounded-xl shadow-md overflow-hidden border-l-4 border-blue-500">
    <div class="p-6">
      <div class="flex items-center mb-4">
        <div class="bg-blue-100 p-3 rounded-lg mr-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
        </div>
        <h3 class="text-xl font-bold text-gray-800">Make a Request</h3>
      </div>
      <p class="text-gray-700 mb-4">
        Need blood for a patient? Create a blood request that donors can see and respond to.
      </p>
      <a href="/make_request" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition duration-300 text-sm inline-block">
        Create Request
      </a>
    </div>
  </div>

  <!-- Card 3: Find Donors -->
  <div class="bg-white rounded-xl shadow-md overflow-hidden border-l-4 border-blue-500">
    <div class="p-6">
      <div class="flex items-center mb-4">
        <div class="bg-blue-100 p-3 rounded-lg mr-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </div>
        <h3 class="text-xl font-bold text-gray-800">Find Donors</h3>
      </div>
      <p class="text-gray-700 mb-4">
        Search our database of registered blood donors by location, blood type, and availability.
      </p>
      <a href="/filter_donors" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition duration-300 text-sm inline-block">
        Search Donors
      </a>
    </div>
  </div>
</div>

<!-- Recent Requests Section -->
<div class="bg-white rounded-xl shadow-md overflow-hidden">
  <div class="border-b border-gray-200 px-6 py-4">
    <h2 class="text-2xl font-bold text-gray-800">Your Recent Blood Requests</h2>
  </div>
  
  {% if user_requests %}
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Patient Name</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Blood Type</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Units</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {% for req in user_requests %}
        <tr class="hover:bg-gray-50 transition duration-150">
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ loop.index }}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{{ req.patient_name }}</td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
              {{ req.blood_type_needed }}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{{ req.units_needed }}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{{ req.contact_number }}</td>
          <td class="px-6 py-4 whitespace-nowrap">
            {% if req.status == 'Pending' %}
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                {{ req.status }}
              </span>
            {% else %}
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                {{ req.status }}
              </span>
            {% endif %}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            {% if req.status == 'Pending' %}
            <form method="POST" action="{{ url_for('auth.close_request', request_id=req.id) }}" class="inline" onsubmit="return confirm('Marking this as Closed means the need has been fulfilled. Are you sure?');">
              <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-md text-sm font-medium transition duration-300">
                Fulfill/Close
              </button>
            </form>
            {% else %}
            <button class="bg-gray-400 text-white px-3 py-1 rounded-md text-sm font-medium cursor-not-allowed" disabled>
              Closed
            </button>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="px-6 py-8 text-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
    </svg>
    <h3 class="text-lg font-medium text-gray-900 mb-2">No blood requests yet</h3>
    <p class="text-gray-500 mb-4">You haven't made any blood requests yet.</p>
    <a href="/make_request" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 transition duration-300">
      Make Your First Request
    </a>
  </div>
  {% endif %}
</div>
{% endblock %}